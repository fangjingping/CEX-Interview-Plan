# 场景演练手册（合约链路）

## 场景 1：撮合延迟抖动
- 症状：P99 突增、队列堆积、行情延迟扩大。
- 排查：GC/锁竞争/热点分配/JFR。
- 修复：对象复用、背压、批处理与容量调整。

## 场景 2：幂等失效导致重复成交
- 症状：订单重复成交、账本差异。
- 排查：请求 ID 去重链路、事件日志重放。
- 修复：幂等表 + TTL、幂等写入与回放校验。

## 场景 3：强平瀑布与保险基金耗尽
- 症状：连续强平、市场冲击加剧。
- 排查：风险限额、强平队列、ADL 排序。
- 修复：价格保护、分层强平、限流与降级。

## 场景 4：行情断线与增量缺口
- 症状：客户端快照不一致、增量缺口。
- 排查：序列号断层、补偿回放机制。
- 修复：快照 + 增量重放、缺口检测与重拉。

## 场景 5：Kafka Rebalance 抖动
- 症状：消费延迟突增、分区重分配。
- 排查：心跳超时、处理耗时过长。
- 修复：消费者隔离、批处理与超时配置优化。

## 场景 6：Redis 热点 Key 与击穿
- 症状：缓存穿透、请求洪峰。
- 排查：热点 Key 分布与 TTL。
- 修复：热点拆分、本地缓存与熔断。

## 场景 7：对账差异与错账修复
- 症状：撮合与账本不一致。
- 排查：事件缺失、幂等写入与补偿记录。
- 修复：差异回放、补偿分录与审计记录。

## 评估要点
- 是否能给出证据链（指标、日志、回放）。
- 是否有明确的修复与预防闭环。

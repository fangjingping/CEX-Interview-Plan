# 架构要点（CEX）

本文用于面试讨论与系统设计演练，概述典型 CEX 交易核心的关键组件与数据流。

## 核心流程

1. 订单接入（API / Gateway）
2. 风控校验（余额、限额、预冻结）
3. 排序（按交易对或市场分片）
4. 撮合引擎（价格优先、时间优先）
5. 账本更新（余额、费用、仓位）
6. 行情（成交、盘口更新）
7. 持久化（事件日志、快照、审计）

## 关键组件

- Gateway：鉴权、限流、幂等
- Risk：冻结资金、保证金校验、违规撤单
- Sequencer：单品种单线程，保证确定性
- Matching：内存订单簿 + 确定性撮合规则
- Ledger：双录账本、追加写、对账任务
- Pricing：指数价/标记价与资金费率计算
- Liquidation：强平队列、ADL 与保险基金联动
- 行情数据：扇出、节流、快照 + 增量

## 资金与合规域

- 钱包/托管：充值确认、提现审批、热/冷钱包分层
- 清结算：手续费与资金费率结算、日终对账
- 合规：KYC/AML、审计留存、合规报表
- 法币：PSP 对接、法币出入金与拒付处理

## 扩展性要点

- 按交易对或市场分片
- 专用日志（Kafka / Pulsar）承载事件
- 快照 + 回放用于恢复
- API 读模型（CQRS 风格）

## 一致性与延迟

- 撮合需要严格顺序与低延迟
- 账本必须与撮合结果一致
- 优先使用追加写事件日志做对账

## 面试关注点

- 订单事件的 Exactly-once vs At-least-once
- 确定性回放与故障恢复
- 背压与慢消费者处理
- 取舍：内存速度 vs 持久化安全

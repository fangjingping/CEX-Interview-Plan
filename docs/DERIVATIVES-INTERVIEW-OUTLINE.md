# CEX 合约方向面试大纲（Java 资深）

面向“生产级别撮合与清结算”的技术面试准备清单，聚焦高并发、高可用、一致性、幂等、可扩展性与可恢复性，并覆盖 Java 基础与中间件实战能力。重点在合约链路，现货与借贷仅作概念提及。

## 手册索引（四大方向）
- `docs/handbooks/system-design-consistency.md`: 系统设计与一致性
- `docs/handbooks/java-concurrency-jvm.md`: Java 并发与 JVM 性能
- `docs/handbooks/middleware-data.md`: 中间件与数据层
- `docs/handbooks/business-risk.md`: 合约业务与风控

## 扩展手册索引（全业务）
- `docs/handbooks/wallet-custody.md`: 钱包与托管
- `docs/handbooks/account-permission.md`: 账户体系与权限
- `docs/handbooks/settlement-reconciliation.md`: 清结算与对账
- `docs/handbooks/market-data.md`: 行情与数据分发
- `docs/handbooks/compliance-ops.md`: 合规与运营治理
- `docs/handbooks/spring-cloud-platform.md`: Spring Cloud 治理

## 面试补充资料
- `docs/COMPETENCY-MATRIX.md`: 能力矩阵与红线
- `docs/DERIVATIVES-FORMULAS.md`: 合约公式速查
- `docs/SCENARIO-PLAYBOOK.md`: 场景演练手册
- `docs/ENGINEERING-DRILLS.md`: 工程实操演练
- `docs/INTERVIEW-RUBRICS.md`: 评分标准与档位

## 1. 业务与领域基础
- 合约类型：永续、交割合约；币本位/USDT 本位。
- 核心概念：仓位、保证金、杠杆、标记价、指数价、资金费率、爆仓与强平、保险基金、ADL。
- 保证金模式：逐仓/全仓/统一保证金与风险限额阶梯。
- 仓位模式：单向/对冲、逐仓与全仓的差异。
- 订单类型：限价/市价/止损/止盈/减仓/只减仓/IOC/FOK/Post-only。
- 费用模型：交易费、资金费率、强平罚金、滑点影响。

## 2. 交易与风控链路
- 交易链路：网关 → 风控 → 撮合 → 账本 → 行情 → 持久化。
- 预交易风控：余额冻结、风险限额、仓位与杠杆校验、最小下单量、价格保护。
- 事后风控：强平引擎、ADL 优先级、保险基金管理。

## 3. 撮合与性能
- 价格优先/时间优先，单品种单线程撮合（确定性）。
- 内存订单簿结构与撮合复杂度。
- 吞吐/延迟目标：热点品种的可扩展策略（分片/队列/背压）。
- 关键指标：P99 延迟、撮合吞吐、行情延迟、回放耗时。

## 4. 一致性与幂等
- 命令幂等：订单 ID、客户端请求 ID、重试去重。
- 事件溯源：撮合结果 → 账本 → 行情的一致顺序。
- Exactly-once vs At-least-once：事件日志、去重表、重放策略。
- 状态恢复：快照 + 事件回放、校验与对账流程。

## 5. 高并发与高可用
- 分区策略：按交易对/市场分片；单写多读。
- 组件隔离：撮合、风控、账本、行情独立扩容。
- 容灾：多机房、热备、延迟切换、只读降级。
- JVM 性能：G1/ZGC、对象池、NUMA、线程模型与尾延迟治理。

## 6. Java 基础与并发能力
- Java 17 语言基础：集合、泛型、异常、NIO、反射与类加载。
- 并发模型：JMM、锁与 CAS、并发容器、线程池与背压。
- 性能排障：GC 日志、内存泄漏、线程堆栈、热点方法定位。
- 工程能力：构建与依赖管理（Maven）、测试可维护性。
- JVM 优化：GC 选型、JIT/Code Cache、对象分配与内存布局。

## 7. 中间件与数据一致性
- 消息系统：顺序性、消费幂等、重放、延迟消息与死信队列。
- Kafka/Pulsar：分区策略、ISR、Exactly-once 与事务的取舍。
- Redis：缓存一致性、热点 Key、过期策略、分布式锁与限流。
- 数据库：事务隔离级别、索引设计、读写分离、分库分表。
- ES：索引设计、写入刷新与查询一致性。

## 8. 关键系统设计题
- 标记价/指数价计算与异常行情保护。
- 强平队列与强平撮合优先级。
- 资金费率结算时的影响与一致性保障。
- 保证金与仓位管理的双录账本（Double-entry）。

## 9. 架构治理与安全合规
- API 安全：签名、鉴权、重放攻击防护、风控策略。
- 合规与审计：日志留存、数据完整性、可追溯性。
- 风控治理：限流、反刷、黑白名单、异常检测。
- 平台治理：注册中心、配置中心、熔断降级与灰度发布。
- 市场监察：异常交易识别、操纵检测与审计证据链。

## 10. 技术栈与实现建议（Java）
- 网络：Netty；序列化：Protobuf/FlatBuffers。
- 事件流：Kafka/Pulsar；缓存：Redis；存储：PostgreSQL/MySQL。
- 并发：Disruptor/无锁队列；消息顺序保证。
- 应用框架：Spring Boot 3 + Spring Cloud 2023（网关与治理）。
- 监控：Prometheus + Grafana；日志：结构化日志 + Trace。

## 11. 测试、演练与运营
- 单元测试：撮合规则、FIFO、订单边界。
- 压测：高并发下单、撤单风暴、行情风暴。
- 容灾演练：回放一致性、快照恢复、幂等重放。
- 发布与回滚：灰度/蓝绿、配置中心、开关治理。
- 运行手册：故障定位、SLO/SLI、容量规划。
- 生产级检查：参考 `docs/PRODUCTION-READINESS.md`。

## 12. 多模块演示方向
现有模块
- `matching-engine`: 订单簿/撮合
- `demo-system-design`: 事件日志 + 快照回放
- `demo-java-concurrency`: 单线程撮合队列 + 背压
- `demo-middleware`: 幂等消费 + 去重
- `demo-risk`: 保证金比率与强平判定
- `position-ledger`: 仓位/保证金台账
- `liquidation-engine`: 强平/ADL
- `pricing`: 指数价/标记价/资金费率
- `persistence`: 事件日志与快照
- `wallet-custody`: 充值幂等 + 提现冻结
- `account-ledger`: 双录账本与幂等入账
- `settlement-recon`: 费用对账与差异标记
- `gateway-auth`: 签名校验与防重放
- `market-data`: 盘口聚合与 Top N 快照
- `demo-resilience`: 限流、熔断、注册发现与配置中心
- `demo-low-latency`: 低延迟环形队列与背压
- `demo-jvm-tuning`: GC 日志分析与抖动定位
- `demo-profiling`: 性能剖析与热点定位
- `demo-trade-pipeline`: 合约交易链路集成演示
- `demo-resilience-boot`: Boot 3 + Spring Cloud 治理示例

拟扩展模块
- `gateway`: API/鉴权/限流/幂等

## 13. CTO 面试题库与评估要点
面向“可交付生产级系统”的候选人，强调工程落地、系统权衡、风险意识与团队协作。

### 13.1 业务与风控
必问：强平流程如何设计？资金费率如何影响仓位与风险？  
加分：如何处理极端行情、指数价异常、保险基金耗尽？  
追问：只减仓/减仓单的幂等与状态机如何设计？  
评估：能否把业务规则转为可执行策略与边界处理。

### 13.2 撮合与账本一致性
必问：撮合结果与账本/行情如何保证顺序一致？  
加分：事件日志、快照与回放策略如何保证确定性？  
追问：如何处理撮合与撤单并发、乱序到达？  
评估：能否明确“一致性边界”和可接受的延迟。

### 13.3 Java 并发与性能
必问：JMM、锁与 CAS 的差异与适用场景？  
加分：GC 调优、内存泄漏定位、线程栈与火焰图分析。  
追问：热点品种撮合如何降低分配与 GC 压力？  
评估：是否具备线上性能排障与优化闭环能力。

### 13.4 中间件与数据层
必问：Kafka 顺序性、幂等消费与重放怎么做？  
加分：Redis 热点 Key、缓存一致性与分布式锁风险。  
追问：数据库隔离级别与撮合/账本事务如何取舍？  
评估：能否说明“为何选择该方案”及其失败模式。

### 13.5 高可用与容灾
必问：RTO/RPO 如何定义与保障？  
加分：多机房一致性、流量切换、只读降级策略。  
追问：发生数据错账时如何恢复并对账？  
评估：是否有真实演练经验与可操作流程。

### 13.6 安全、合规与治理
必问：API 签名、防重放、限流、风控策略如何落地？  
加分：审计留存、数据完整性校验、敏感数据保护。  
追问：合规变化如何在系统中快速落地？  
评估：是否具备“安全默认”和合规敏感性。

### 13.7 运行与工程管理
必问：SLO/SLI 如何制定？关键告警怎么设计？  
加分：灰度/回滚、配置中心治理、故障复盘机制。  
追问：如何做容量规划与成本控制？  
评估：是否具备可持续运维与团队协作能力。

## 14. 面试答题框架（推荐）
问题澄清 → 目标与约束 → 架构拆分 → 一致性与可用性权衡 → 数据与消息流 → 失败模式与降级 → 监控与演练 → 成本与演进路径。

## 15. CTO 深度面试题库（四大方向）

### 15.1 系统设计与一致性（撮合/账本/高可用）
必问
- 设计合约交易核心链路，定义关键不变量与一致性边界。
- 撮合、账本与行情如何保持顺序一致？在哪些点可异步？
- 撤单、成交、强平并发时，如何避免状态错乱？
加分
- 热点品种扩展：分片、排队、背压与降级策略。
- 快照与回放：如何保证确定性与快速恢复？
追问
- 发生部分写入或重复事件时，如何纠正与对账？
- 机房级故障下，RTO/RPO 如何兑现？
答题框架
- 先列出不变量（资金守恒、时间优先、风控前置），再讲数据流与失败处理。
评估要点
- 能否说明权衡（延迟 vs 一致性）与可验证的恢复路径。

### 15.2 Java 并发与 JVM 性能
必问
- JMM、happens-before、volatile 与锁的语义差异。
- 线程池与队列如何选型，如何实现背压与限流？
- GC 选择与调优思路（G1/ZGC），如何降低停顿？
加分
- 对象分配与逃逸分析、false sharing、cache line。
- NIO/Netty 的线程模型与零拷贝场景。
追问
- 线上卡顿/高延迟如何定位（jstack、GC log、火焰图）？
- OOM 的常见根因与修复路径？
答题框架
- 先定位问题类型（CPU/内存/锁/IO），再给可观测证据链。
评估要点
- 是否具备“问题定位 → 复现 → 修复 → 验证”的闭环能力。

### 15.3 中间件与数据层（Kafka/Redis/DB）
必问
- Kafka 如何保证顺序？分区键如何设计？
- 幂等消费如何落地？重复消息与乱序如何处理？
- Redis 热点 Key 与缓存一致性策略如何选？
- 账本落库的事务隔离级别与一致性保证？
加分
- 事务性消息、Exactly-once 的限制与替代方案。
- Schema 演进与兼容策略（Protobuf/Avro）。
追问
- Rebalance 导致的消费抖动如何治理？
- 数据库性能瓶颈下的分库分表策略？
答题框架
- 先讲业务约束（顺序/一致性/延迟），再讲中间件选择与失败模式。
评估要点
- 能否解释“为什么这样设计”以及如何监控与回退。

### 15.4 业务、风控与极端行情
必问
- 标记价/指数价的计算与异常处理。
- 强平规则、保证金与仓位的状态机设计。
- 资金费率结算对 PnL 与风险的影响。
加分
- 保险基金耗尽、ADL 的触发与排序策略。
- 价格保护、熔断与异常行情隔离。
追问
- 极端行情下如何防止错杀与系统雪崩？
- 风控策略如何支持快速配置与审计？
答题框架
- 先定义风险边界与触发条件，再描述执行与可回溯机制。
评估要点
- 是否具备“风险优先”的设计意识与可操作流程。

## 16. 全业务补充题库（扩展）

### 16.1 钱包与托管
必问
- 热/冷钱包体系如何设计？如何保障密钥安全？
- 充值确认与链重组如何处理？
追问
- 大额提现如何分层审批与风控？
- 异常资产或链上攻击如何应对？

### 16.2 账户体系与权限
必问
- 主/子账户与 API Key 权限模型如何设计？
- 高风险操作如何做最小权限与审计？
追问
- 权限变更对历史操作审计如何处理？
- 多角色协作下如何避免越权？

### 16.3 清结算与对账
必问
- 撮合、账本与钱包如何对账？差异如何修复？
- 资金费率、手续费结算如何落地？
追问
- 日终与日内对账的差异如何处理？
- 账本异常如何回滚与补偿？

### 16.4 行情与数据分发
必问
- 快照与增量如何保持一致？
- 高并发订阅下如何做节流与降级？
追问
- 客户端断线重连如何恢复？
- 行情延迟如何监控与优化？

### 16.5 合规与运营治理
必问
- KYC/AML、制裁名单与 Travel Rule 如何落地？
- 法币出入金如何对账与风控？
追问
- 合规规则变更如何灰度发布？
- 审计与监管报表如何确保一致性？

### 16.6 平台治理与 Spring Cloud
必问
- 限流、熔断、降级如何组合？如何避免误伤？
- 注册中心与配置中心如何做容灾与回滚？
追问
- 治理策略如何度量与自动化？
- 大促或极端行情下如何按指标动态扩容？

# 系统设计与一致性手册（CTO 面试向）

## 目标
建立“撮合-账本-行情-持久化”的一致性边界，明确可异步环节与可恢复路径，能够说明延迟、吞吐与一致性的权衡。

## 关键不变量
- 资金守恒：撮合结果与账本变更必须对齐，可追溯、可回放。
- 顺序确定性：同品种事件在单一序列内严格排序。
- 幂等与去重：重复请求、消息重放不可产生二次影响。
- 状态可恢复：快照 + 事件回放可重建一致状态。

## 体系结构要点
- 链路：网关 → 风控 → 撮合 → 账本 → 行情 → 持久化。
- 线程模型：单品种单线程撮合，确定性优先。
- 事件流：撮合结果写入事件日志，再派生账本/行情更新。
- 数据边界：账本为强一致核心，行情为准实时最终一致。

## 典型面试题与追问
必问
- 撮合结果如何与账本、行情保持顺序一致？
- 在低延迟与强一致之间如何取舍？
追问
- 回放时如何处理重复事件与部分写入？
- 异地容灾下 RTO/RPO 如何达成？

## 常见陷阱
- 只谈吞吐不谈一致性边界。
- 不区分撮合结果与行情推送的强弱一致需求。
- 缺少恢复路径与对账策略。

## 演示关联
- 代码模块：`demo-system-design`
- 建议演示：事件日志、快照、回放顺序与幂等处理。
